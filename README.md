# 简单模型机设计——微程序与硬布线实现

### <!-- TOC -->

## 目录

- [一、微程序实现](#一、微程序实现)
  - [1. 模型机设计基本步骤](#1. 模型机设计基本步骤)
  - [2. 指令系统](#2. 指令系统)
    - [2.1 基本字长](#2.1 基本字长)
    - [2.2 指令格式](#2.2 指令格式)
    - [2.3 指令类型](#2.3 指令类型)
    - [2.4 寻址方式](#2.4 寻址方式)
    - [2.5 指令功能及对应操作码](#2.5 指令功能及对应操作码)
  - [3. 总体架构与数据通路](#3. 总体架构与数据通路)
    - [3.1 总体架构框图](#3.1 总体架构框图)
    - [3.2 功能部件作用](#3.2 功能部件作用)
    - [3.3 数据通路](#3.3 数据通路)
    - [3.4 部件设计原理图](#3.4 部件设计原理图)
  - [4. 控制方式](#4. 控制方式)
    - [4.1 CU 框图 ](#4.1 CU 框图 )
    - [4.2 部件设计原理图](#4.2 部件设计原理图)
    - [4.3 指令执行流程](#4.3 指令执行流程)
    - [4.4 微指令格式](#4.4 微指令格式)
    - [4.5 微程序编写](#4.5 微程序编写)
- [二、硬布线实现](#二、硬布线实现)
  - [1. CU 框图](#1. CU 框图)
  - [2. 节拍发生器](#2. 节拍发生器)
  - [3. 时序信号形成部件](#3. 时序信号形成部件)
  - [4. 译码器](#4. 译码器)
  - [5. 启停电路](#5. 启停电路)
  - [6. 指令执行流程](#6. 指令执行流程)
  - [7. 控制信号](#7. 控制信号)
    - [7.1 控制信号列表](#7.1 控制信号列表)
    - [7.2 控制信号的逻辑表达式](#7.2 控制信号的逻辑表达式)
  - [8. RAM 应用程序](#8. RAM 应用程序)
  - [9. 运行和测试结果](#9. 运行和测试结果)
- [遇到的问题和解决办法](#遇到的问题和解决办法)



## 一、微程序实现

### 1. 模型机设计基本步骤

- 拟定指令系统
- 确定总体架构
- 逻辑设计
- 确定控制方式
- 编制指令流程
- 编制微程序
- 调试



### 2. 指令系统

#### 2.1 基本字长

8 位 / 16 位，内存容量为 256 \* 8



#### 2.2 指令格式

单字长指令：指令由高 4 位操作码、低 4 位全 0 构成；

双字长指令：16 位，指令由第一字节高 4 位操作码、低 4 位全 0，第二字节操作数或操作数地址构成；

基本字长：8 位。



#### 2.3 指令类型

单操作数指令，无操作数指令（操作码 OP 为 4 位，最多定义 16 条指令）。



#### 2.4 寻址方式

与操作码绑定，采用固定模式。有立即数寻址、直接寻址和间接寻址、寄存器寻址四种寻址方式。 

立即数寻址：操作数在指令的第二个字节 ；

直接寻址：操作数的地址在指令的第二个字节 ；

间接寻址：操作数的地址为指令的第二个字节对应的地址的内容 ；

寄存器寻址：与操作码对应，表示不同寄存器的寻址 ；

指令的地址码为 8 位，跟在操作码的下地址字段。



#### 2.5 指令功能及对应操作码

|  指令   |               指令功能                | 指令对应操作码 |
| :-----: | :-----------------------------------: | :------------: |
| LOAD 0  |             R0 立即数寻址             |      0001      |
| LOAD 1  |             R1 立即数寻址             |      0010      |
| LOAD 00 |              R0 直接寻址              |      0011      |
| LOAD 01 |              R1 直接寻址              |      0100      |
|   ADD   |          R0+R1->R1，直接寻址          |      0101      |
|   AND   |          R0&R1->R1，直接寻址          |      0110      |
|   XOR   |          R0^R1->R1，直接寻址          |      0111      |
|  R0--   |          R0-1->R0，直接寻址           |      1000      |
|   MUL   |          R0×R1->R1，直接寻址          |      1001      |
|   DIV   |          R0/R1->R1，直接寻址          |      1010      |
|   JMP   |              无条件跳转               |      1011      |
| STORE0  | 把 R0 中内容存到 RAM 下地址表示的地址 |      1100      |
| STORE1  | 把 R1 中内容存到 RAM 下地址表示的地址 |      1101      |
|  BRZ0   |       条件跳转，若 R0=0 则跳转        |      1110      |
|  HALT   |                 停机                  |      1111      |

计算元件替换拓展指令： 

以下指令通过更改 ALU 中除法计算电路为其他计算电路实现，故共享 1010 操作码。

SQRT：小数格式下 R0 的平方根->R1,直接寻址 

ABS：补码格式下:R0 绝对值->R1 ,直接寻址 

DOT：Multi-Hot 编码格式下，R0 和 R1 的向量内积，结果存入 R1 

Comp：若 R0<R1，R1=0 否则 R1=1 

Complement：将原码表示的 R0 数据转化为补码表示，结果存入 R1



### 3. 总体架构与数据通路

#### 3.1 总体架构框图

![image-20220531205657692](https://s2.loli.net/2022/05/31/M43I1PhXi92eLYA.png)

#### 3.2 功能部件作用

1）寄存器组：

R0、R1 为通用寄存器， 8 位，可存放操作数或结果、中间结果。在 CPR0 或 CPR1 的作用下接收总线的数据送入相应的寄存器，输出连入选择器。 IR 为指令寄存器， 8 位，用来存储从 RAM 中取出的指令。PC 为带复位的程序计数器， 8 位， 存储下一条将要执行的指令的地址。MAR 为带复位的地址寄存器，8 位，该寄存器提供对 RAM 进行读写的地址。

2）二选一选择器：

因为我们的算术运算器的数据来源有很多，所以需要设计数据选择器。连入 A 选择器的数据来源是 RAM 的读出数据和 R0 寄存器的数据； 连入 B 选择器的数据来源是 PC 的数据和 R1 的数据。通过取得不同的数据来实现不同的功能。

3）ALU 运算器：

ALU 为组合 74181 和 74182 的算术运算器，接收从 A 和 B 两个端口传来的数据进行相应的运算并输出，可以提供的加法、直传、减法、判断全 0、判断进位的操作。 具体情况如下图所示：

![image-20220531205832342](https://s2.loli.net/2022/05/31/jURxqJHvar4Vi7o.png)

4）存储器 

RAM 和 CROM 调用 Quartus 内部集成的存储器元件完成，前者的字长为 8 位，负责存储待执行的程序指令，后者的字长为 24 位，负责存储微程序。微程序一经写好便不再改动，因此采用不可修改的 ROM，运行的程序需要频繁读写，因此采用 RAM。



#### 3.3 数据通路

模型机的数据通路是以总线为基础,以 CPU 为核心构成的。下面就实现基本操作 R0+R1→R1→RAM 分析其数据通路：

1）取指令

![image-20220531205916483](https://s2.loli.net/2022/05/31/7Z8QBKdfAwbLoD3.png)

2）送指令地址 

![image-20220531205930482](https://s2.loli.net/2022/05/31/Q9wH7eR1PJNfLWr.png)

3）指令计数器加 1

![image-20220531205943737](https://s2.loli.net/2022/05/31/lntEcUuDw8xeWyN.png)

4）R0+R1->R0 

5）R1->RAM

![image-20220531210001042](https://s2.loli.net/2022/05/31/LntGC4kEUujRH36.png)



#### 3.4 部件设计原理图

1）寄存器的设计 

带复位的寄存器：MAR 地址寄存器是一个带复位的寄存器，带复位是指当有复位信号时，MAR 清零。程序计数器 PC 结构同上，是有复位信号的 8 位寄存器。PC 加 1 是通过加法器实现的。复位信号 CLRN 的作用是有复位信号时，计数器 PC 清零。这里直接用 74273 来实现。

![image-20220531210058095](https://s2.loli.net/2022/05/31/X1ad2LNiV8bjKxM.png)

不带复位的寄存器： 

结构中 R0、R1 通用寄存器，每个寄存器均由 8 个 D 触发器构成。 指令寄存器 IR 其结构同通用寄存器。

![image-20220531210114159](https://s2.loli.net/2022/05/31/6WX3SZyuVR2Psx8.png)

2）二选一选择器的设计 

通过 AY 和 BY 使能端来控制选择的是哪 8 位数。

![image-20220531210127672](https://s2.loli.net/2022/05/31/sBqMh9X8l6KSDbC.png)

3）ALU 的设计 

用 74181 芯片和 74182 芯片来实现。

![image-20220531210146205](https://s2.loli.net/2022/05/31/jnJ2k1Lc3laotWq.png)

4）乘法器的设计 

根据 uIR23 来判断是否采用乘法操作，如果是乘法，就读取 R0 和 R1 的低 4 位执行乘法并把结果保存，否则就执行直传 ALU 的操作。

![image-20220531210200809](https://s2.loli.net/2022/05/31/O6LwmTahYyVECU7.png)

5）启停电路的设计 

当单脉冲给到寄存器时激活其进行工作，在连续脉冲的作用下以此工作；在停机指令有效时关闭所有操作。

![image-20220531210212330](https://s2.loli.net/2022/05/31/CWNedwLEJVQa6DU.png)、

6）平方根电路的设计

![image-20220531210222981](https://s2.loli.net/2022/05/31/XH8wWah9q5DLr2b.png)

7）绝对值计算电路的设计

![image-20220531210233383](https://s2.loli.net/2022/05/31/RcQKoawjNd2hzlE.png)

![image-20220531210241214](https://s2.loli.net/2022/05/31/AQSk6JPgV5Mxzri.png)

8）向量内积计算电路

![image-20220531210254304](https://s2.loli.net/2022/05/31/KeEFnv9lXGZRYpm.png)

9）比较器电路

![image-20220531210305703](https://s2.loli.net/2022/05/31/OAv8pbmzrYDM2UH.png)

10）RAM 中保存的指令：

![image-20220531210316464](https://s2.loli.net/2022/05/31/4wtCPXIVg2YqNUS.png)

图中实现了一个斐波那契函数的计算。

11）CROM 中的微程序数据：

![image-20220531210331359](https://s2.loli.net/2022/05/31/SFwIhr7d2iL6j9V.png)



### 4. 控制方式

#### 4.1 CU 框图 

如下所示，主要由控制存储器 CROM（256X24）、后继微地址形成电路、译码器、RAM（256X8）构成。

![image-20220531210409097](https://s2.loli.net/2022/05/31/7nYKyo6O3Iu19jN.png)

微程序控制时序：

![image-20220531210419741](https://s2.loli.net/2022/05/31/AjLYymsMX8V7c2t.png)

![image-20220531210437739](https://s2.loli.net/2022/05/31/B6ghG4AHTIk5aS2.png)

通过节拍发生器的使用，每次脉冲的第一个节拍 CP_1 的上升沿用做控制存储器读命令 URD； 

脉冲的第二个节拍 CP_2 的上升边沿将读出的 ROM 中的微指令得到的 WR/RD 送 RAM 得到 RAM 的输出指令送到总线上； 

脉冲的第三个节拍 CP_3 的上升沿完全所有其余脉冲操作，包括将形成的后继地址送微程序计数器 uPC，同时将运算结果（总线的数据）送指定的寄存器。 

其中后继微地址形成电路如下：

![image-20220531210501743](https://s2.loli.net/2022/05/31/2idJfMx4EtNbhZO.png)

当 LD＝1 时，微程序计数 uPC 执行加 1 操作。 

当 LD＝0 时且 JP＝ 1 时，无条件转移，由微指令的中的八位提供转移地址。 当 LD＝0 时且 QJP＝1 时，按操作码转移。



#### 4.2 部件设计原理图

1）启停电路 

为使用连续脉冲，方便控制脉冲，增加了启动/停止电路。

![image-20220531210557453](https://s2.loli.net/2022/05/31/CWNedwLEJVQa6DU.png)

2）节拍发生器 

方便控制微程序时序，完成具有先后顺序的步骤操作。

![image-20220531210606341](https://s2.loli.net/2022/05/31/wGaN4kzucthyebm.png)

3）3-8 译码器 

用于数据分配。寄存器 CP 信号的控制、后继地址生成的控制信号都用 3- 8 译码器来通过 UIR 中的三位得到 8 种不同的控制信号（用到了其中的五种），方便扩展信号。

![image-20220531210620009](https://s2.loli.net/2022/05/31/Cs2kwI38FxM9lfO.png)

4）2-4 译码器 

用于数据分配。 两个选择器 A、B 都用 2-4 译码器来通过 UIR 中的两位得到4 种不同的控制信号（用到其中的两种）从而决定选择器的选择数据。

![image-20220531210632058](https://s2.loli.net/2022/05/31/hdygq3J5WrDpHUx.png)

5）uPC

uPC 存储着 ROM 中要执行的下一条微指令的地址，与后继地址生成部件组合使用。 输入来自后继微地址形成部件，输出到 ROM 的地址输入端。

![image-20220531210643386](https://s2.loli.net/2022/05/31/3RZVI89xcUtH5l4.png)

6）微地址形成部件 

功能为多路选择器。当 JP=1，QJP=0 时，Y7Y6Y5Y4Y3Y2Y1Y0=UIR15 UIR14 UIR13 UIR12 UIR11 UIR10 UIR9 UIR8。当 JP=0，QJP=1 时，Y7Y6Y5Y4Y3Y2Y1Y0=IR7 IR6 IR5 IR4 0000。连接时，Y7Y6Y5Y4Y3Y2Y1Y0 连接 uPC 的 D7~D0,uPC 的 RE 接19复位键 RES。

![image-20220531210702247](https://s2.loli.net/2022/05/31/nxvt6zBgGkC4wh7.png)

7）部件之间的连接 

部件之间的连接是采用以 CPU 为中心的总线连接方式。加法器的输出通过总线 BUS 连接到所有寄存器和存储器的输入端，除指令寄存器 IR 和地址寄存器 MAR 的输出端外，其它部件的输出端分别送入选择器 A 和选择器 B。连接图如下所示：

![image-20220531210717379](https://s2.loli.net/2022/05/31/JGrUBYTju6e8sy7.png)

具体实现如下：

![image-20220531210726443](https://s2.loli.net/2022/05/31/4x2BtvbwYsSjXHh.png)

由于线路较为复杂，连接是采取线路命名方式连接。



#### 4.3 指令执行流程

1）微程序入口及入口地址、各节拍微操作实现如下

![image-20220531210754803](https://s2.loli.net/2022/05/31/HGQy4aAvc739Cxu.png)

![image-20220531210759311](https://s2.loli.net/2022/05/31/mgPKRQq7MEoexkW.png)

2）定义机器指令如下：（示例程序之一） 

![image-20220531210810844](https://s2.loli.net/2022/05/31/PKJjZfkCHQFVnp4.png)

其中 R0 与 R1 是寄存器中数据的实时显示。 



3）节拍分析如下： 

指令的微操作中的每一条微指令都由之前提到的三个节拍完成，第一个节拍取出 ROM 中的内容，第二个节拍取出或者写入 RAM，第三个节拍完成其他的需要脉冲的操作，每次都是三个节拍完成一条微指令。



#### 4.4 微指令格式

微指令字长 24 位即 UIR23~UIR0。

1）微指令字段定义 

![image-20220531210908090](https://s2.loli.net/2022/05/31/dx2p6HzFEKwQ5SU.png)

![image-20220531210943407](https://s2.loli.net/2022/05/31/krLTKtibVmq4Cf9.png)

![image-20220531210926552](https://s2.loli.net/2022/05/31/ePBlwIa2qKiJXWG.png)

![image-20220531210951140](https://s2.loli.net/2022/05/31/1zXlapFoj9umKrA.png)



2）微命令形成逻辑 

微命令形成逻辑电路如下图所示，图中的 2-4 译码器和 3-8 译码器在前面已做介绍。

![image-20220531211007383](https://s2.loli.net/2022/05/31/VTmqZ19Eh8IU3ki.png)

进一步地，使用μ23 作为乘法选择位，使用μ22 作为除法选择位，实际分配如下表：

![image-20220531211019880](https://s2.loli.net/2022/05/31/MSbARyQHB8oGKjY.png)

3）CROM 中的微程序及地址、节拍如下所示：

![image-20220531211035174](C:/Users/Elford/AppData/Roaming/Typora/typora-user-images/image-20220531211035174.png)

或直接访问 [微代码](#https://bucket011.obs.cn-north-4.myhuaweicloud.com:443/%E5%BE%AE%E4%BB%A3%E7%A0%81.xlsx?AccessKeyId=EPMCKIK9NRITQHB3EEVR&Expires=1669731900&Signature=DggpDmr0n3Te1%2BSf/2Xy2sKNm34%3D) 将表格下载至本地查看，URL 有效期至 2022-12-04。



#### 4.5 微程序编写

1）编写简单示例程序如下，R0 和 R1 为该时刻两寄存器中应有的内容：

![image-20220531211255382](https://s2.loli.net/2022/05/31/tPbc6qMOX1jr8CD.png)

示例微程序 2 如下，执行斐波那契数列的计算：

![image-20220531211303969](https://s2.loli.net/2022/05/31/OgmGKSjPLRfBQpX.png)

2）微程序代码： 

CROM 中机器语言存储的指令数据如下（分别以二进制和十六进制）：

![image-20220531211312950](https://s2.loli.net/2022/05/31/U1q8C7lXmNLOc4G.png)

![image-20220531211318000](https://s2.loli.net/2022/05/31/zO8gHy3EYdbPDlU.png)

示例微程序 2 的指令如下：

![image-20220531211326564](https://s2.loli.net/2022/05/31/UxRGLX3TzEBNSpA.png)

可以发现，借助条件跳转指令可以用简洁的指令完成较为复杂的程序。





## 二、硬布线实现

### 1. CU 框图

硬布线实现的 CU 框图如图所示。

![image-20220531211432265](https://s2.loli.net/2022/05/31/HEz4rDbn9i1d2kB.png)



### 2. 节拍发生器

使用节拍发生器（Timing，几个触发器构成的时序逻辑电路）不同的状态组合来区分一条指令不同的执行步骤，指令执行步骤的接续是通过变换节拍发生器的状态组合完成的，不同于微程序控制器中通过下地址部件给出不同的微指令地址来实现。

根据指令执行流程，设计时序分为取指周期和执行周期，每个周期为 4 节拍，波形图如图 23 所示。其中 W1 高电平时是取指周期的 4 节拍，W2 高电平时是执行周期的 4 节拍。

![image-20220531211531307](https://s2.loli.net/2022/05/31/p6Rk52rDljZtgmT.png)

节拍发生器原理图如图所示：

![image-20220531211544497](https://s2.loli.net/2022/05/31/u9UNsaLSA7drnKe.png)

Q1Q0 变换 00、01、10、11，从 01、10 的变化有中间状态 00；同理，从 11、00 的变化有中间状态 10，所以，m0、m2 不能做触发脉冲。上述原理图中模 4 增 1 计数器的原理图如图 所示：

![image-20220531211604216](https://s2.loli.net/2022/05/31/8gJsiRUXVcpoSlv.png)

### 3. 时序信号形成部件

组合逻辑控制器是通过由“与—或” 两级逻辑关系构成的时序控制信号产生部件来直接给出全部的时序控制信号。送到第一级各“与门”的输入信号是指令操作码和节拍发生器的节拍状态(可能还有控制条件)，每个与门产生一个与项输出，相关的与项输出信号送到第二级的 “或门” ，每个或门输出的就是一个时序控制信号。全部的时序控制信号由许多个 “与—或”逻辑门给出。 

时序控制信号形成部件生成的器件如图所示：

![image-20220531211636507](https://s2.loli.net/2022/05/31/7gNiOzXyHrZ6fPG.png)

### 4. 译码器

操作码译码器使用 4-16 译码器，其原理图如图所示：

 ![image-20220531211709551](https://s2.loli.net/2022/05/31/HcCWZpwuJRK26lU.png)

### 

### 5. 启停电路

为使用连续脉冲，增加启停电路，其原理图如图所示。

![image-20220531211749279](https://s2.loli.net/2022/05/31/OGI7fpvbuEKYZg2.png)



### 6. 指令执行流程

硬布线设计中整体指令的执行流程如图所示。并给出每条指令的取值周期、执行周期的微操作和节拍安排。

![image-20220531211821301](https://s2.loli.net/2022/05/31/FxsVYNTRM3uy8ad.png)

![image-20220531211829244](https://s2.loli.net/2022/05/31/8ni7NItvEDyQbAM.png)

![image-20220531211836526](https://s2.loli.net/2022/05/31/FqovJxQnVLSs4WH.png)

![image-20220531211842821](https://s2.loli.net/2022/05/31/mQ5ZpL6XCEryszJ.png)

![image-20220531211851546](https://s2.loli.net/2022/05/31/uL4ylMh7NA6Uf5F.png)

![image-20220531211858423](https://s2.loli.net/2022/05/31/jIM6BxLSwPJ5iWD.png)

![image-20220531211905387](https://s2.loli.net/2022/05/31/7HmtA1GyDbpwFZ3.png)

![image-20220531211911842](https://s2.loli.net/2022/05/31/b2NTnPsdMIlS6g7.png)

![image-20220531211918936](https://s2.loli.net/2022/05/31/7SajmWtioNEl3KD.png)

![image-20220531211926523](https://s2.loli.net/2022/05/31/6TtC5G2Snel34gU.png)





### 7. 控制信号

#### 7.1 控制信号列表

硬布线设计中涉及到的控制信号如表所示。

![image-20220531212002714](https://s2.loli.net/2022/05/31/yG8OlgNAWHRIYPS.png)



#### 7.2 控制信号的逻辑表达式

上述控制信号的逻辑表达式如下：

![image-20220531212030354](https://s2.loli.net/2022/05/31/48XdR5uHmaVFJlw.png)

![image-20220531212038334](https://s2.loli.net/2022/05/31/WMUYNl8maeEkBuf.png)



### 8. RAM 应用程序

该 RAM 程序为一段循环进行的斐波那契数列计算程序，可以通过更改内存的 01H 和 09H 位置输入其实值，输出结果循环计算并存储再内存 09H 位置中。

![image-20220531212106660](https://s2.loli.net/2022/05/31/3V5lMcexbQ9sTut.png)



### 9. 运行和测试结果

![image-20220531212121080](https://s2.loli.net/2022/05/31/BIV2Hw7Ov9r1xiy.png)





## 遇到的问题和解决办法

1）问题：按照 ppt 上设计的 ROM 的 24 位分配情况来进行连接，仿真时，发现脉冲上升下降沿与期待不符，通过 3-8 译码器得到的 5 个脉冲正好与期待的脉冲相反，同时 RAM 的读写也是失败的。 

解决方法：仔细检查非门的使用问题，经同学解释后，发现原来 ppt 上使用的有些器件是需要进行脉冲的取反的，而我自己的器件都是自行设计的，不需要进行取反。了解后，得到 RAM 都是高电平进行读入与写出，并不是低电平有效。于是将得到 CPR0, CPR1, CPPC, CPIR, CPMAR 的与门的输入端直接链接脉冲 C3,就行，不需要进行非操作。同样，UIR4 和 UIR5 得到的信号分别连接 RAM 的 WR和 RD 即可，也不需要进行非操作。



2）问题：进行仿真模拟时，ROM 永远在第一个脉冲的上升沿不会进行操作（读取数据），后面一个脉冲才进行读取操作，同时，后面又会偶尔有几个脉冲也不能正常读取。解决方法：测试了很多个 ROM 及仿真了很多个简单程序，发现其他地方没 

问题，主要就是 ROM 本身的问题，后来发现单独的一个 ROM 只连接了脉冲这个简单程序仍有问题后，和同学讨论后发现，原来当初的 ROM 的制作设定有问题。我不小心将’q’output port 选中了，这会在输入脉冲与输出 q 直接加一个与门，最终影响输出结果，把该端口去掉就可以了。 



3）问题：脉冲上升下降沿好了后，发现仍不能正常运行，程序运行顺序十分混乱。

解决方法：这是因为程序有运行的先后顺序关系，必须要先进行 ROM 的读出才能得到关于 RAM 的读写指令 RD/WR，如果需要读 RAM 数据，则也必须要先读出RAM 数据后，才能将其通过总线传给相应的寄存器。于是，可以设置一个节拍发生器，3 个节拍足矣。依顺序分别生成 ROM 的脉冲，RAM 的脉冲，其他所有寄存器等的脉冲。于是问题得到解决。 



4）问题：最后大部分都成功了，就是最后有一个进行 AND 操作后的结果存到寄存器成功，但不能正确存入 RAM 对应的地址中。 

解决方法：仔细看 ROM 中的微操作，发现有个地方只是改了 A 选择和 B 选择及输出分配的数据，却忘了对相应的微操作修改 M S3 S2 S1 S0 C0 的内容，然而 S3S2S1S0 决定了是 A 直传还是 B 直传，也是需要修改的。